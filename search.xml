<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>网易云歌单下载——Python程序制作</title>
    <url>/2020/03/12/2020-3-12-Netease-cloud-playlist-download/</url>
    <content><![CDATA[<p>今天和大家分享的是一个用Python实现的网易云歌单下载小工具。</p>
<h1 id="前期准备"><a href="#前期准备" class="headerlink" title="前期准备"></a>前期准备</h1><p>在编写这个程序时，使用的环境是：</p>
<ul>
<li>Windows  10 Professional</li>
<li>Python 3.7.5</li>
<li>wxPython 4.0.7.post2</li>
<li>requests 2.22.0</li>
<li>lxml 4.5.0</li>
<li>beutifulsoup4 4.8.2</li>
<li>IDE: PyCharm2017</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">    @author: chen</span></span><br><span class="line"><span class="string">    @date: 2020/2/22</span></span><br><span class="line"><span class="string">    @description: 这是一个以wxpython作GUI，</span></span><br><span class="line"><span class="string">    @requirements: wxPython==4.0.7.post2</span></span><br><span class="line"><span class="string">                   requests==2.22.0</span></span><br><span class="line"><span class="string">                   lxml==4.5.0</span></span><br><span class="line"><span class="string">                   beautifulsoup4==4.8.2</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="comment"># 导入第三方库</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> wx</span><br><span class="line"><span class="keyword">import</span> wx.xrc</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入自定义设置</span></span><br><span class="line"><span class="keyword">import</span> settings</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义主窗口</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MusicDownloadFrame</span><span class="params">(wx.Frame)</span>:</span></span><br><span class="line">    musicData = []</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        wx.Frame.__init__(self, <span class="literal">None</span>, id=wx.ID_ANY, title=settings.title,pos=wx.DefaultPosition, size=settings.size, style=settings.style)</span><br><span class="line"></span><br><span class="line">        self.SetSizeHints(wx.DefaultSize, wx.DefaultSize)</span><br><span class="line">        self.SetBackgroundColour(wx.SystemSettings.GetColour(wx.SYS_COLOUR_WINDOW))</span><br><span class="line"></span><br><span class="line">        bSizer4 = wx.BoxSizer(wx.VERTICAL)</span><br><span class="line">        bSizer5 = wx.BoxSizer(wx.HORIZONTAL)</span><br><span class="line">        self.m_staticText3 = wx.StaticText(self, wx.ID_ANY, settings.url_tip,wx.DefaultPosition, wx.DefaultSize, <span class="number">0</span>)</span><br><span class="line">        self.m_staticText3.Wrap(<span class="number">-1</span>)</span><br><span class="line">        self.m_staticText3.SetFont(wx.Font(<span class="number">13</span>, wx.FONTFAMILY_DECORATIVE, wx.FONTSTYLE_NORMAL, wx.FONTWEIGHT_NORMAL, <span class="literal">False</span>, wx.EmptyString))</span><br><span class="line">        bSizer5.Add(self.m_staticText3, <span class="number">0</span>, wx.ALL, <span class="number">5</span>)</span><br><span class="line">        self.url_text = wx.TextCtrl(self, wx.ID_ANY, wx.EmptyString, wx.DefaultPosition, wx.Size(<span class="number">300</span>, <span class="number">-1</span>), <span class="number">0</span>)</span><br><span class="line">        bSizer5.Add(self.url_text, <span class="number">0</span>, wx.ALL, <span class="number">5</span>)</span><br><span class="line">        self.down_button = wx.Button(self, wx.ID_ANY, settings.down_tip, wx.DefaultPosition, wx.DefaultSize, <span class="number">0</span>)</span><br><span class="line">        bSizer5.Add(self.down_button, <span class="number">0</span>, wx.ALL, <span class="number">5</span>)</span><br><span class="line">        bSizer4.Add(bSizer5, <span class="number">1</span>, wx.EXPAND, <span class="number">4</span>)</span><br><span class="line">        self.output_text = wx.TextCtrl(self, wx.ID_ANY, settings.status_init, wx.DefaultPosition, wx.Size(<span class="number">600</span>, <span class="number">320</span>), wx.TE_MULTILINE)</span><br><span class="line">        bSizer4.Add(self.output_text, <span class="number">0</span>, wx.ALL, <span class="number">5</span>)</span><br><span class="line">        self.SetSizer(bSizer4)</span><br><span class="line">        self.Layout()</span><br><span class="line">        self.Centre(wx.BOTH)</span><br><span class="line">        <span class="comment"># 连接时的事件</span></span><br><span class="line">        self.down_button.Bind(wx.EVT_BUTTON, self.main_button_click)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(settings.down_path):</span><br><span class="line">            os.mkdir(settings.down_path)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__del__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">main_button_click</span><span class="params">(self, event)</span>:</span></span><br><span class="line">        self.musicData = []</span><br><span class="line">        <span class="keyword">if</span> self.getMusicData(self.url_text.GetValue().replace(<span class="string">"#/"</span>,<span class="string">""</span>)) == <span class="literal">None</span>:</span><br><span class="line">            time.sleep(<span class="number">5</span>)</span><br><span class="line">            sys.exit(requests.exceptions.ConnectionError)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.musicData = self.getMusicData(self.url_text.GetValue().replace(<span class="string">"#/"</span>,<span class="string">""</span>))</span><br><span class="line"></span><br><span class="line">        print(self.musicData)</span><br><span class="line">        <span class="keyword">if</span> len(self.musicData) &gt; <span class="number">1</span>:</span><br><span class="line">            self.output_text.AppendText(<span class="string">u"歌单/排行榜中的歌曲已经获取成功，即将开始下载...\n"</span>)</span><br><span class="line">            self.get(self.musicData)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.output_text.AppendText(<span class="string">'这个歌单好像不存在呢，是不是网络有问题，或者链接写错了，没有下载到音乐。/(ㄒoㄒ)/~~'</span>)</span><br><span class="line">            time.sleep(<span class="number">5</span>)</span><br><span class="line">            sys.exit(<span class="string">"音乐下载失败"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, values)</span>:</span></span><br><span class="line">        print(len(values))     <span class="comment"># Todo 这里打印歌单/排行榜条目时有点乱</span></span><br><span class="line">        downNum = <span class="number">0</span></span><br><span class="line">        rstr = <span class="string">r"[\/\\\:\*\?\"\&lt;\&gt;\|]"</span>  <span class="comment"># 作为文件名时不可以使用的字符</span></span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> values:       <span class="comment"># Todo 这有个神仙变量</span></span><br><span class="line">            x[<span class="string">'name'</span>] = re.sub(rstr, <span class="string">"_"</span>, x[<span class="string">'name'</span>])        <span class="comment"># 将作为文件名时不可以使用的字符替换成下划线</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(settings.down_path + x[<span class="string">'name'</span>] + <span class="string">'.mp3'</span>):</span><br><span class="line">                self.output_text.AppendText(<span class="string">'***** '</span> + x[<span class="string">'name'</span>] + <span class="string">'.mp3 ***** 下载中...\n'</span>)</span><br><span class="line">                url = <span class="string">'http://music.163.com/song/media/outer/url?id='</span> + x[<span class="string">'id'</span>] + <span class="string">'.mp3'</span></span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    self.saveFile(url, settings.down_path + x[<span class="string">'name'</span>] + <span class="string">'.mp3'</span>)</span><br><span class="line">                    downNum = downNum + <span class="number">1</span></span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    x = x - <span class="number">1</span></span><br><span class="line">                    self.output_text.AppendText(<span class="string">u'下载失败~\n'</span>)</span><br><span class="line">        <span class="keyword">if</span> downNum != <span class="number">0</span>:</span><br><span class="line">            self.output_text.AppendText(<span class="string">'下载完成'</span> + str(downNum) + <span class="string">'个音乐，快去沉浸到音乐当中去吧！'</span>)</span><br><span class="line">            time.sleep(<span class="number">5</span>)</span><br><span class="line">            sys.exit(<span class="string">"音乐下载完成"</span>)</span><br><span class="line">        <span class="keyword">elif</span> downNum == <span class="number">0</span>:</span><br><span class="line">            self.output_text.AppendText(<span class="string">'这个歌单好像不存在呢，是不是网络有问题，或者链接写错了，没有下载到音乐。/(ㄒoㄒ)/~~'</span>)</span><br><span class="line">            sys.exit(<span class="string">"音乐下载失败"</span>)</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getMusicData</span><span class="params">(self, url)</span>:</span></span><br><span class="line">        headers = &#123;<span class="string">'User-Agent'</span>: settings.user_agent&#125;</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            webData = requests.get(url, headers=headers).text</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            self.output_text.AppendText(<span class="string">'服务器好像跑到火星去了呢，连接中断,程序即将退出，/(ㄒoㄒ)/~~'</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        soup = BeautifulSoup(webData, <span class="string">'lxml'</span>)</span><br><span class="line">        find_list = soup.find(<span class="string">'ul'</span>, class_=<span class="string">"f-hide"</span>).find_all(<span class="string">'a'</span>)</span><br><span class="line"></span><br><span class="line">        tempArr = []</span><br><span class="line">        <span class="keyword">for</span> a <span class="keyword">in</span> find_list:</span><br><span class="line">            music_id = a[<span class="string">'href'</span>].replace(<span class="string">'/song?id='</span>, <span class="string">''</span>)</span><br><span class="line">            music_name = a.text</span><br><span class="line">            tempArr.append(&#123;<span class="string">'id'</span>: music_id, <span class="string">'name'</span>: music_name&#125;)</span><br><span class="line">        <span class="keyword">return</span> tempArr</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">saveFile</span><span class="params">(self, url, path)</span>:</span></span><br><span class="line">        headers = settings.down_headers</span><br><span class="line">        response = requests.get(url, headers=headers)</span><br><span class="line">        <span class="keyword">with</span> open(path, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(response.content)</span><br><span class="line">            f.flush()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    app = wx.App(<span class="literal">False</span>)</span><br><span class="line">    frame = MusicDownloadFrame()</span><br><span class="line">    frame.Show(<span class="literal">True</span>)</span><br><span class="line">    <span class="comment"># 启动程序</span></span><br><span class="line">    app.MainLoop()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello</title>
    <url>/2020/03/12/2020-3-12-Hello/</url>
    <content><![CDATA[<p>大家好！这里是追梦人的博客，会分享一些编程，学习，以及一些好的文章喜欢我就收藏吧。<br>！！！！！！！！！！！！！！<br>！！！重要的事情说三遍！！！<br>！本博客内所有文章仅供学习！<br>！本博客内所有文章仅供学习！<br>！本博客内所有文章仅供学习！<br>！如需转载请联系<a href="mailto://jgbsxx20130315@163.com">jgbsx20130315@163.com</a>!<br>!并注明出处               !<br>！切勿用于商业或者恶意用途！<br>！！！！！！！！！！！！！！</p>
]]></content>
      <tags>
        <tag>其他</tag>
      </tags>
  </entry>
</search>
